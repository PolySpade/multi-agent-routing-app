2025-11-11 15:31:20 - app.agents.flood_agent - ERROR - send_to_hazard_agent:882 - flood_agent_001 failed to forward data to HazardAgent: 'HazardAgent' object has no attribute 'process_hazard_data'
2025-11-11 15:35:35 - app.agents.flood_agent - ERROR - send_to_hazard_agent:882 - flood_agent_001 failed to forward data to HazardAgent: 'HazardAgent' object has no attribute 'process_hazard_data'
2025-11-11 16:59:22 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-11 16:59:22 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-11 16:59:22 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-11T16:35:34.988710", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-11T16:35:34.988710", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-11T16:35:34.988710", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-11T16:35:34.988710", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-11T16:35:34.988710", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 0.0, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 30.22, "humidity_pct": 77, "pressure_hpa": 1007, "forecast_hourly": [{"timestamp": "2025-11-11T16:00:00", "rain_mm": 0.0, "temp_c": 30.47, "humidity_pct": 76, "pop": 0}, {"timestamp": "2025-11-11T17:00:00", "rain_mm": 0.0, "temp_c": 30.22, "humidity_pct": 77, "pop": 0}, {"timestamp": "2025-11-11T18:00:00", "rain_mm": 0.0, "temp_c": 30.11, "humidity_pct": 78, "pop": 0}, {"timestamp": "2025-11-11T19:00:00", "rain_mm": 0.0, "temp_c": 29.6, "humidity_pct": 79, "pop": 0}, {"timestamp": "2025-11-11T20:00:00", "rain_mm": 0.0, "temp_c": 29, "humidity_pct": 80, "pop": 0}, {"timestamp": "2025-11-11T21:00:00", "rain_mm": 0.0, "temp_c": 28.36, "humidity_pct": 81, "pop": 0}], "timestamp": "2025-11-11T16:35:35.198042", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 751.95, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -0.05, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -0.05, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-11", "water_level_change_hr": 24.0, "water_level_change_amt": 1.59, "timestamp": "2025-11-11T16:35:36.204183", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.9, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.9, "rule_curve_elevation_m": 200.38, "deviation_from_rule_curve_m": 10.52, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-11", "water_level_change_hr": 24.0, "water_level_change_amt": 0.53, "timestamp": "2025-11-11T16:35:36.204183", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.95, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.05, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.05, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-11", "water_level_change_hr": 24.0, "water_level_change_amt": 0.17, "timestamp": "2025-11-11T16:35:36.204183", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.5, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-11", "water_level_change_hr": 24.0, "water_level_change_amt": 0.21, "timestamp": "2025-11-11T16:35:36.204183", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.62, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.48, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-11", "water_level_change_hr": 24.0, "water_level_change_amt": -0.33, "timestamp": "2025-11-11T16:35:36.204183", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.53, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.62, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-11", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-11T16:35:36.204183", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.92, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.08, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 1.29, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-11", "water_level_change_hr": 24.0, "water_level_change_amt": 2.18, "timestamp": "2025-11-11T16:35:36.204183", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.31, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.69, "rule_curve_elevation_m": 219.54, "deviation_from_rule_curve_m": -3.23, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-11", "water_level_change_hr": 24.0, "water_level_change_amt": 0.53, "timestamp": "2025-11-11T16:35:36.204183", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 278.25, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": -1.75, "rule_curve_elevation_m": 279.03, "deviation_from_rule_curve_m": -0.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-11", "water_level_change_hr": 24.0, "water_level_change_amt": 4.73, "timestamp": "2025-11-11T16:35:36.204183", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-11T16:59:22.130061", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

