2025-11-12 20:29:14 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 20:29:14 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 20:29:14 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T20:29:06.390386", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T20:29:06.390386", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T20:29:06.390386", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T20:29:06.390386", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T20:29:06.390386", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 4.92, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.8, "humidity_pct": 84, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T20:00:00", "rain_mm": 0.0, "temp_c": 28.8, "humidity_pct": 84, "pop": 0}, {"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.48, "humidity_pct": 83, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.05, "humidity_pct": 83, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 27.5, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 26.9, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.16, "humidity_pct": 86, "pop": 0}], "timestamp": "2025-11-12T20:29:06.572371", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T20:29:07.721848", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T20:29:07.721848", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T20:29:07.721848", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T20:29:07.721848", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T20:29:07.721848", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T20:29:07.721848", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T20:29:07.721848", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T20:29:07.721848", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T20:29:07.721848", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T20:29:14.773941", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 20:44:39 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 20:44:39 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 20:44:39 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T20:44:31.545515", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T20:44:31.545515", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T20:44:31.545515", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T20:44:31.545515", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T20:44:31.545515", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 4.92, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.67, "humidity_pct": 84, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T20:00:00", "rain_mm": 0.0, "temp_c": 28.42, "humidity_pct": 83, "pop": 0}, {"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.67, "humidity_pct": 84, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.32, "humidity_pct": 83, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 27.85, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.32, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.46, "humidity_pct": 86, "pop": 0}], "timestamp": "2025-11-12T20:44:31.719593", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T20:44:32.849566", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T20:44:32.849566", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T20:44:32.849566", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T20:44:32.849566", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T20:44:32.849566", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T20:44:32.849566", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T20:44:32.849566", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T20:44:32.849566", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T20:44:32.849566", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T20:44:39.893211", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:36:00 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:36:00 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:36:00 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 85, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 84, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:35:52.851042", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:36:00.364605", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:36:00 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:36:00 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:36:00 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 85, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 84, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:35:52.851042", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:36:00.364605", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:36:00 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:36:00 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:36:00 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 85, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 84, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:35:52.851042", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:36:00.364605", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:36:00 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:36:00 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:36:00 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 85, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 84, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:35:52.851042", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:36:00.364605", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:36:00 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:36:00 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:36:00 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 85, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 84, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:35:52.851042", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:36:00.364605", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:36:00 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:36:00 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:36:00 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:35:52.659410", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 85, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 84, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:35:52.851042", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:35:53.774683", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:36:00.364605", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:41:09 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:41:09 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:41:09 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 86, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:41:00.737436", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:41:09.598343", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:41:09 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:41:09 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:41:09 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 86, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:41:00.737436", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:41:09.598343", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:41:09 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:41:09 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:41:09 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 86, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:41:00.737436", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:41:09.598343", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:41:09 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:41:09 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:41:09 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 86, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:41:00.737436", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:41:09.598343", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:41:09 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:41:09 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:41:09 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 86, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:41:00.737436", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:41:09.598343", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:41:09 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:41:09 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:41:09 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 86, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:41:00.737436", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:41:09.598343", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:41:09 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:41:09 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:41:09 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 86, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:41:00.737436", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:41:09.598343", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:41:09 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:41:09 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:41:09 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:41:00.540603", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.66, "humidity_pct": 86, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.37, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.66, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 28.25, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.76, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 27, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:41:00.737436", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:41:01.692191", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:41:09.598343", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:57:03 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:57:03 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:57:03 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.26, "humidity_pct": 86, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.05, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.26, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 27.93, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.52, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.6, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 26.92, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:56:57.253344", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:57:03.173664", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:57:03 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:57:03 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:57:03 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.26, "humidity_pct": 86, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.05, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.26, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 27.93, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.52, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.6, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 26.92, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:56:57.253344", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:57:03.173664", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:57:03 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:57:03 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:57:03 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.26, "humidity_pct": 86, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.05, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.26, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 27.93, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.52, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.6, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 26.92, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:56:57.253344", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:57:03.173664", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-12 21:57:03 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-12 21:57:03 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-12 21:57:03 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-12T21:56:57.059912", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 5.08, "forecast_6h_mm": 0.0, "intensity": "none", "temperature_c": 28.26, "humidity_pct": 86, "pressure_hpa": 1011, "forecast_hourly": [{"timestamp": "2025-11-12T21:00:00", "rain_mm": 0.0, "temp_c": 28.05, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-12T22:00:00", "rain_mm": 0.0, "temp_c": 28.26, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-12T23:00:00", "rain_mm": 0.0, "temp_c": 27.93, "humidity_pct": 85, "pop": 0}, {"timestamp": "2025-11-13T00:00:00", "rain_mm": 0.0, "temp_c": 27.52, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T01:00:00", "rain_mm": 0.0, "temp_c": 27.6, "humidity_pct": 86, "pop": 0}, {"timestamp": "2025-11-13T02:00:00", "rain_mm": 0.0, "temp_c": 26.92, "humidity_pct": 87, "pop": 0}], "timestamp": "2025-11-12T21:56:57.253344", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.22, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.78, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.78, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -1.73, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.3, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.3, "rule_curve_elevation_m": 200.66, "deviation_from_rule_curve_m": 9.64, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.6, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 572.31, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -2.69, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -2.69, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.64, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.41, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.09, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.65, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.45, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.03, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.55, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.6, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.02, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 190.53, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -2.47, "rule_curve_elevation_m": 189.63, "deviation_from_rule_curve_m": 0.9, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": -0.39, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.38, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.62, "rule_curve_elevation_m": 219.62, "deviation_from_rule_curve_m": -3.24, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 0.07, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.58, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.58, "rule_curve_elevation_m": 278.94, "deviation_from_rule_curve_m": 1.64, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-12", "water_level_change_hr": 24.0, "water_level_change_amt": 2.33, "timestamp": "2025-11-12T21:56:58.298640", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-12T21:57:03.173664", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\minem\OneDrive\Documents\Coding Project\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-13 13:55:21 - app.main - ERROR - broadcast:173 - Error sending to WebSocket: 
2025-11-13 13:55:21 - app.main - ERROR - broadcast:174 - Exception type: WebSocketDisconnect
2025-11-13 13:55:21 - app.main - ERROR - broadcast:176 - Traceback: Traceback (most recent call last):
  File "C:\Users\Donald\Documents\Code\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 331, in send
    output = self.conn.send(wsproto.events.Message(data=data))  # type: ignore
  File "C:\Users\Donald\Documents\Code\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\__init__.py", line 64, in send
    data += self.connection.send(event)
  File "C:\Users\Donald\Documents\Code\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\wsproto\connection.py", line 107, in send
    raise LocalProtocolError(
wsproto.utilities.LocalProtocolError: Event Message(data='{"type": "flood_update", "data": {"Montalban": {"water_level_m": null, "alert_level_m": 22.4, "alarm_level_m": 23.0, "critical_level_m": 23.6, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-13T13:55:10.148359", "source": "PAGASA_API"}, "Nangka": {"water_level_m": null, "alert_level_m": 16.5, "alarm_level_m": 17.1, "critical_level_m": 17.7, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-13T13:55:10.148359", "source": "PAGASA_API"}, "Rosario Bridge": {"water_level_m": null, "alert_level_m": 13.0, "alarm_level_m": 13.5, "critical_level_m": 14.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-13T13:55:10.148359", "source": "PAGASA_API"}, "Sto Nino": {"water_level_m": null, "alert_level_m": 15.0, "alarm_level_m": 16.0, "critical_level_m": 17.0, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-13T13:55:10.148359", "source": "PAGASA_API"}, "Tumana Bridge": {"water_level_m": null, "alert_level_m": 17.26, "alarm_level_m": 18.26, "critical_level_m": 19.26, "status": "normal", "risk_score": 0.0, "timestamp": "2025-11-13T13:55:10.148359", "source": "PAGASA_API"}, "Marikina_weather": {"location": "Marikina", "coordinates": [14.6507, 121.1029], "current_rainfall_mm": 0.0, "rainfall_24h_mm": 0.34, "forecast_6h_mm": 0.23, "intensity": "none", "temperature_c": 31.16, "humidity_pct": 74, "pressure_hpa": 1009, "forecast_hourly": [{"timestamp": "2025-11-13T13:00:00", "rain_mm": 0.0, "temp_c": 31.23, "humidity_pct": 73, "pop": 0.03}, {"timestamp": "2025-11-13T14:00:00", "rain_mm": 0.0, "temp_c": 31.16, "humidity_pct": 74, "pop": 0.39}, {"timestamp": "2025-11-13T15:00:00", "rain_mm": 0.0, "temp_c": 30.97, "humidity_pct": 73, "pop": 0.8}, {"timestamp": "2025-11-13T16:00:00", "rain_mm": 0.0, "temp_c": 30.93, "humidity_pct": 75, "pop": 0.78}, {"timestamp": "2025-11-13T17:00:00", "rain_mm": 0.23, "temp_c": 30.31, "humidity_pct": 77, "pop": 0.98}, {"timestamp": "2025-11-13T18:00:00", "rain_mm": 0.0, "temp_c": 29.54, "humidity_pct": 80, "pop": 0.73}], "timestamp": "2025-11-13T13:55:10.435624", "source": "OpenWeatherMap_API"}, "AMBUKLAO": {"dam_name": "AMBUKLAO", "reservoir_water_level_m": 750.52, "normal_high_water_level_m": 752.0, "deviation_from_nhwl_m": -1.48, "rule_curve_elevation_m": 752.0, "deviation_from_rule_curve_m": -1.48, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-13", "water_level_change_hr": 24.0, "water_level_change_amt": 0.3, "timestamp": "2025-11-13T13:55:11.405119", "source": "PAGASA_Dam_Monitoring"}, "ANGAT": {"dam_name": "ANGAT", "reservoir_water_level_m": 210.02, "normal_high_water_level_m": 210.0, "deviation_from_nhwl_m": 0.02, "rule_curve_elevation_m": 200.94, "deviation_from_rule_curve_m": 9.08, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-13", "water_level_change_hr": 24.0, "water_level_change_amt": -0.28, "timestamp": "2025-11-13T13:55:11.405119", "source": "PAGASA_Dam_Monitoring"}, "BINGA": {"dam_name": "BINGA", "reservoir_water_level_m": 573.7, "normal_high_water_level_m": 575.0, "deviation_from_nhwl_m": -1.3, "rule_curve_elevation_m": 575.0, "deviation_from_rule_curve_m": -1.3, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-13", "water_level_change_hr": 24.0, "water_level_change_amt": 1.39, "timestamp": "2025-11-13T13:55:11.405119", "source": "PAGASA_Dam_Monitoring"}, "CALIRAYA": {"dam_name": "CALIRAYA", "reservoir_water_level_m": 287.19, "normal_high_water_level_m": 0.0, "deviation_from_nhwl_m": 0.0, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "watch", "risk_score": 0.3, "latest_time": "08:00 AM", "latest_date": "Nov-13", "water_level_change_hr": 24.0, "water_level_change_amt": -0.22, "timestamp": "2025-11-13T13:55:11.405119", "source": "PAGASA_Dam_Monitoring"}, "IPO": {"dam_name": "IPO", "reservoir_water_level_m": 100.97, "normal_high_water_level_m": 101.1, "deviation_from_nhwl_m": -0.13, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-13", "water_level_change_hr": 24.0, "water_level_change_amt": 0.32, "timestamp": "2025-11-13T13:55:11.405119", "source": "PAGASA_Dam_Monitoring"}, "LA MESA": {"dam_name": "LA MESA", "reservoir_water_level_m": 78.63, "normal_high_water_level_m": 80.15, "deviation_from_nhwl_m": -1.52, "rule_curve_elevation_m": 0.0, "deviation_from_rule_curve_m": 0.0, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-13", "water_level_change_hr": 24.0, "water_level_change_amt": 0.08, "timestamp": "2025-11-13T13:55:11.405119", "source": "PAGASA_Dam_Monitoring"}, "MAGAT DAM": {"dam_name": "MAGAT DAM", "reservoir_water_level_m": 189.86, "normal_high_water_level_m": 193.0, "deviation_from_nhwl_m": -3.14, "rule_curve_elevation_m": 189.75, "deviation_from_rule_curve_m": 0.11, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-13", "water_level_change_hr": 24.0, "water_level_change_amt": -0.67, "timestamp": "2025-11-13T13:55:11.405119", "source": "PAGASA_Dam_Monitoring"}, "PANTABANGAN": {"dam_name": "PANTABANGAN", "reservoir_water_level_m": 216.33, "normal_high_water_level_m": 221.0, "deviation_from_nhwl_m": -4.67, "rule_curve_elevation_m": 219.7, "deviation_from_rule_curve_m": -3.37, "status": "normal", "risk_score": 0.1, "latest_time": "08:00 AM", "latest_date": "Nov-13", "water_level_change_hr": 24.0, "water_level_change_amt": -0.05, "timestamp": "2025-11-13T13:55:11.405119", "source": "PAGASA_Dam_Monitoring"}, "SAN ROQUE": {"dam_name": "SAN ROQUE", "reservoir_water_level_m": 280.72, "normal_high_water_level_m": 280.0, "deviation_from_nhwl_m": 0.72, "rule_curve_elevation_m": 278.84, "deviation_from_rule_curve_m": 1.88, "status": "alert", "risk_score": 0.5, "latest_time": "08:00 AM", "latest_date": "Nov-13", "water_level_change_hr": 24.0, "water_level_change_amt": 0.14, "timestamp": "2025-11-13T13:55:11.405119", "source": "PAGASA_Dam_Monitoring"}}, "timestamp": "2025-11-13T13:55:21.006381", "source": "flood_agent"}', frame_finished=True, message_finished=True) cannot be sent in state ConnectionState.CLOSED.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Donald\Documents\Code\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 86, in send
    await self._send(message)
  File "C:\Users\Donald\Documents\Code\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "C:\Users\Donald\Documents\Code\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\uvicorn\protocols\websockets\wsproto_impl.py", line 350, in send
    raise ClientDisconnected from exc
uvicorn.protocols.utils.ClientDisconnected

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Donald\Documents\Code\multi-agent-routing-app\masfro-backend\app\main.py", line 170, in broadcast
    await connection.send_text(json_str)
  File "C:\Users\Donald\Documents\Code\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 166, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\Donald\Documents\Code\multi-agent-routing-app\masfro-backend\.venv\lib\site-packages\starlette\websockets.py", line 89, in send
    raise WebSocketDisconnect(code=1006)
starlette.websockets.WebSocketDisconnect

2025-11-18 12:32:29 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-18 12:32:29 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-18 12:32:29 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-18 12:32:29 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-18 12:32:29 - app.main - ERROR - start_simulation:917 - Error starting simulation: Object of type coroutine is not JSON serializable
2025-11-18 12:32:39 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-18 12:32:39 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-18 12:32:39 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-18 12:32:39 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-18 12:32:39 - app.main - ERROR - start_simulation:917 - Error starting simulation: Object of type coroutine is not JSON serializable
2025-11-18 12:32:41 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-18 12:32:41 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-18 12:32:41 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-18 12:32:41 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-18 12:32:41 - app.main - ERROR - start_simulation:917 - Error starting simulation: Object of type coroutine is not JSON serializable
2025-11-18 12:32:42 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-18 12:32:42 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-18 12:32:42 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-18 12:32:42 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-18 12:32:42 - app.main - ERROR - start_simulation:917 - Error starting simulation: Object of type coroutine is not JSON serializable
2025-11-18 16:57:34 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-18 16:57:34 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-18 16:57:34 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-18 16:57:34 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-18 16:57:34 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-18 16:57:37 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-18 16:57:37 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-18 16:57:37 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-18 16:57:37 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-18 16:57:37 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-18 16:57:40 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-18 16:57:40 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-18 16:57:40 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-18 16:57:40 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-18 16:57:40 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-18 16:57:42 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-18 16:57:42 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-18 16:57:42 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-18 16:57:42 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-18 16:57:42 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:02 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:02 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:02 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:02 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:02 - app.main - ERROR - reset_simulation:1022 - Error resetting simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:06 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:06 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:06 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:06 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:06 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:09 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:09 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:09 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:09 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:09 - app.main - ERROR - reset_simulation:1022 - Error resetting simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:10 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:10 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:10 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:10 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:10 - app.main - ERROR - reset_simulation:1022 - Error resetting simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:10 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:10 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:10 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:10 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:10 - app.main - ERROR - reset_simulation:1022 - Error resetting simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:16 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:16 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:16 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:16 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:16 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:16 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:16 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:16 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:16 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:16 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:16 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:16 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:16 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:16 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:16 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:17 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:17 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:17 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:17 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:17 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:17 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:17 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:17 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:17 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:17 - app.main - ERROR - reset_simulation:1022 - Error resetting simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:17 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:17 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:17 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:17 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:17 - app.main - ERROR - reset_simulation:1022 - Error resetting simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:18 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:18 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:18 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:18 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:18 - app.main - ERROR - reset_simulation:1022 - Error resetting simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:18 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:18 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:18 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:18 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:18 - app.main - ERROR - reset_simulation:1022 - Error resetting simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:18 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:18 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:18 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:18 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:18 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:18 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:18 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:18 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:18 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:18 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:18 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:18 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:18 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:18 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:18 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:18 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:18 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:18 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:18 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:18 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:19 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:19 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:19 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:19 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:19 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 13:34:19 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 13:34:19 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 13:34:19 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 13:34:19 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 13:34:19 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 15:31:00 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:31:29 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:31:29 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:31:56 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:32:25 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:32:55 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:32:56 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:33:26 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:33:26 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:33:56 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:33:57 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:34:12 - app.main - ERROR - get_evacuation_centers:1703 - Error retrieving evacuation centers: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:34:26 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:34:28 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:34:31 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:34:56 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:34:58 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:35:09 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:35:23 - app.main - ERROR - get_evacuation_centers:1703 - Error retrieving evacuation centers: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:35:26 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:35:28 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:35:56 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:35:58 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:36:26 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:36:29 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:36:56 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:36:59 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:37:26 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:37:30 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:37:53 - app.main - ERROR - get_evacuation_centers:1703 - Error retrieving evacuation centers: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:37:56 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:38:01 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:38:20 - app.main - ERROR - get_evacuation_centers:1703 - Error retrieving evacuation centers: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:38:26 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:38:31 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:38:56 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:39:02 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:39:05 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:39:26 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:39:33 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:39:35 - app.main - ERROR - get_evacuation_centers:1703 - Error retrieving evacuation centers: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:39:45 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:39:56 - app.main - ERROR - get_evacuation_centers:1703 - Error retrieving evacuation centers: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:40:03 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:40:15 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:40:34 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:40:45 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:40:59 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:41:04 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:41:05 - app.main - ERROR - get_evacuation_centers:1703 - Error retrieving evacuation centers: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:41:07 - app.main - ERROR - get_evacuation_centers:1703 - Error retrieving evacuation centers: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:41:29 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:41:35 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:41:40 - app.main - ERROR - get_flood_agent_status:1653 - Error retrieving flood status: 0
2025-11-19 15:41:42 - app.main - ERROR - get_scout_reports:1613 - Error retrieving scout reports: can't compare offset-naive and offset-aware datetimes
2025-11-19 15:41:47 - app.main - ERROR - get_flood_agent_status:1653 - Error retrieving flood status: 0
2025-11-19 15:41:47 - app.main - ERROR - get_evacuation_centers:1703 - Error retrieving evacuation centers: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:41:48 - app.main - ERROR - get_scout_reports:1613 - Error retrieving scout reports: can't compare offset-naive and offset-aware datetimes
2025-11-19 15:41:59 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:42:06 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:42:20 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 15:42:20 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 15:42:20 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 15:42:20 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 15:42:20 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 15:42:29 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:42:40 - app.main - ERROR - get_flood_agent_status:1653 - Error retrieving flood status: 0
2025-11-19 15:42:40 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:42:40 - app.main - ERROR - get_evacuation_centers:1703 - Error retrieving evacuation centers: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:42:41 - app.main - ERROR - get_flood_agent_status:1653 - Error retrieving flood status: 0
2025-11-19 15:42:43 - app.main - ERROR - get_flood_agent_status:1653 - Error retrieving flood status: 0
2025-11-19 15:42:44 - app.main - ERROR - get_evacuation_centers:1703 - Error retrieving evacuation centers: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:43:00 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:43:10 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:43:30 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:43:44 - app.main - ERROR - get_all_agents_status:1774 - Error retrieving agents status: 'DynamicGraphEnvironment' object has no attribute 'evacuation_centers'
2025-11-19 15:43:45 - app.main - ERROR - get_flood_agent_status:1653 - Error retrieving flood status: 0
2025-11-19 15:43:45 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 15:43:45 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 15:43:45 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 15:43:45 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 15:43:45 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 15:43:46 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 15:43:46 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 15:43:46 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 15:43:46 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 15:43:46 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 15:43:46 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 15:43:46 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 15:43:46 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 15:43:46 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 15:43:46 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 15:43:47 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 15:43:47 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 15:43:47 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 15:43:47 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 15:43:47 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 15:43:47 - app.main - ERROR - broadcast:169 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 15:43:47 - app.main - ERROR - broadcast:170 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 15:43:47 - app.main - ERROR - broadcast:171 - Message type field: simulation_state
2025-11-19 15:43:47 - app.main - ERROR - broadcast:177 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 15:43:47 - app.main - ERROR - stop_simulation:966 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 15:44:48 - app.main - ERROR - get_evacuation_centers:1708 - Error retrieving evacuation centers: name 'pd' is not defined
2025-11-19 15:44:53 - app.main - ERROR - get_evacuation_centers:1708 - Error retrieving evacuation centers: name 'pd' is not defined
2025-11-19 15:45:10 - app.main - ERROR - get_evacuation_centers:1708 - Error retrieving evacuation centers: name 'pd' is not defined
2025-11-19 15:45:10 - app.main - ERROR - get_evacuation_centers:1708 - Error retrieving evacuation centers: name 'pd' is not defined
2025-11-19 15:45:22 - app.main - ERROR - get_evacuation_centers:1708 - Error retrieving evacuation centers: name 'pd' is not defined
2025-11-19 15:55:10 - app.main - ERROR - get_flood_agent_status:1654 - Error retrieving flood status: 0
2025-11-19 15:55:13 - app.main - ERROR - get_scout_reports:1614 - Error retrieving scout reports: can't compare offset-naive and offset-aware datetimes
2025-11-19 15:55:13 - app.main - ERROR - get_flood_agent_status:1654 - Error retrieving flood status: 0
2025-11-19 16:00:21 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:21 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:21 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:21 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:21 - app.main - ERROR - reset_simulation:1023 - Error resetting simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:23 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:23 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:23 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:23 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:23 - app.main - ERROR - reset_simulation:1023 - Error resetting simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:23 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:23 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:23 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:23 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:23 - app.main - ERROR - reset_simulation:1023 - Error resetting simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:25 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:25 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:25 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:25 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:25 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:25 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:25 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:25 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:25 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:25 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:26 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:26 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:26 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:26 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:26 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:26 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:26 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:26 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:26 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:26 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:26 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:26 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:26 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:26 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:26 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:26 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:26 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:26 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:26 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:26 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:26 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:26 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:26 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:26 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:26 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:26 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:26 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:26 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:26 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:26 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:26 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:45 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:45 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:45 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:45 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:45 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:49 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:49 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:49 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:49 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:49 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:49 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:49 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:49 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:49 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:49 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:49 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:49 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:49 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:49 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:49 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:49 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:49 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:49 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 16:00:49 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 16:00:49 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 16:00:49 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 16:00:49 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 16:19:16 - app.main - ERROR - get_flood_agent_status:1654 - Error retrieving flood status: 0
2025-11-19 16:19:19 - app.main - ERROR - get_flood_agent_status:1654 - Error retrieving flood status: 0
2025-11-19 18:00:31 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 18:00:31 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 18:00:31 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 18:00:31 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 18:00:31 - app.main - ERROR - reset_simulation:1023 - Error resetting simulation: Object of type coroutine is not JSON serializable
2025-11-19 18:00:33 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 18:00:33 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 18:00:33 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 18:00:33 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 18:00:33 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 18:36:23 - app.main - ERROR - get_flood_agent_status:1654 - Error retrieving flood status: 0
2025-11-19 23:58:33 - app.main - ERROR - get_flood_agent_status:1654 - Error retrieving flood status: 0
2025-11-19 23:58:36 - app.main - ERROR - get_flood_agent_status:1654 - Error retrieving flood status: 0
2025-11-19 23:58:39 - app.main - ERROR - get_flood_agent_status:1654 - Error retrieving flood status: 0
2025-11-19 23:58:48 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 23:58:48 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 23:58:48 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 23:58:48 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 23:58:48 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 23:59:32 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 23:59:32 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 23:59:32 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 23:59:32 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 23:59:32 - app.main - ERROR - reset_simulation:1023 - Error resetting simulation: Object of type coroutine is not JSON serializable
2025-11-19 23:59:33 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 23:59:33 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 23:59:33 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 23:59:33 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 23:59:33 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 23:59:33 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 23:59:33 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 23:59:33 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 23:59:33 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 23:59:33 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-19 23:59:34 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-19 23:59:34 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-19 23:59:34 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-19 23:59:34 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-19 23:59:34 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-20 00:02:56 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-20 00:02:56 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-20 00:02:56 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-20 00:02:56 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-20 00:02:56 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-20 00:02:59 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-20 00:02:59 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-20 00:02:59 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-20 00:02:59 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-20 00:02:59 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-20 00:02:59 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-20 00:02:59 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-20 00:02:59 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-20 00:02:59 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-20 00:02:59 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-20 00:03:01 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-20 00:03:01 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-20 00:03:01 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-20 00:03:01 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-20 00:03:01 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-20 00:03:09 - app.main - ERROR - broadcast:170 - JSON serialization error: Object of type coroutine is not JSON serializable
2025-11-20 00:03:09 - app.main - ERROR - broadcast:171 - Message keys: dict_keys(['type', 'event', 'data', 'timestamp'])
2025-11-20 00:03:09 - app.main - ERROR - broadcast:172 - Message type field: simulation_state
2025-11-20 00:03:09 - app.main - ERROR - broadcast:178 - Field 'data' caused error: Object of type coroutine is not JSON serializable, value type: <class 'coroutine'>
2025-11-20 00:03:09 - app.main - ERROR - stop_simulation:967 - Error stopping simulation: Object of type coroutine is not JSON serializable
2025-11-20 00:04:54 - app.main - ERROR - get_flood_agent_status:1654 - Error retrieving flood status: 0
2025-11-20 00:04:54 - app.main - ERROR - get_scout_reports:1614 - Error retrieving scout reports: can't compare offset-naive and offset-aware datetimes
2025-11-20 00:05:00 - app.main - ERROR - get_flood_agent_status:1654 - Error retrieving flood status: 0
2025-11-20 00:05:12 - app.main - ERROR - get_flood_agent_status:1654 - Error retrieving flood status: 0
2025-11-20 00:05:14 - app.main - ERROR - get_flood_agent_status:1654 - Error retrieving flood status: 0
2025-11-20 00:05:16 - app.main - ERROR - get_flood_agent_status:1654 - Error retrieving flood status: 0
2025-11-20 00:31:15 - app.main - ERROR - get_flood_agent_status:1715 - Error retrieving flood status: 0
2025-11-20 00:31:17 - app.main - ERROR - get_flood_agent_status:1715 - Error retrieving flood status: 0
2025-11-20 00:31:24 - app.main - ERROR - get_flood_agent_status:1715 - Error retrieving flood status: 0
2025-11-20 00:32:19 - app.main - ERROR - get_flood_agent_status:1715 - Error retrieving flood status: 0
2025-11-20 00:32:22 - app.main - ERROR - get_flood_agent_status:1715 - Error retrieving flood status: 0
2025-11-20 10:54:52 - app.agents.hazard_agent - ERROR - get_edge_flood_depths:933 - Invalid time_step: 0. Using default: 1
2025-11-20 11:35:33 - app.services.flood_data_scheduler - ERROR - _collection_loop:258 - [ERROR] Scheduled collection error: 'FloodAgent' object has no attribute 'collect_and_forward_data'
2025-11-20 17:58:11 - app.main - ERROR - get_route:651 - Route calculation validation error: Could not map coordinates to road network
2025-11-20 17:58:24 - app.main - ERROR - get_route:651 - Route calculation validation error: Could not map coordinates to road network
2025-11-20 19:36:33 - app.main - ERROR - get_route:651 - Route calculation validation error: Could not map coordinates to road network
