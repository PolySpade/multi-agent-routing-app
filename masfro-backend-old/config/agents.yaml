# MAS-FRO Agent Configuration
# Multi-Agent System for Flood Route Optimization
#
# This file contains all configurable parameters for the agent system.
# Modify values here instead of hardcoding in agent files.

# ==========================================
# ROUTING AGENT CONFIGURATION
# ==========================================
routing_agent:
  # Risk penalty system (Virtual Meters approach)
  # These values convert risk scores (0-1) into "virtual meters"
  # to prevent A* heuristic domination
  risk_penalties:
    safest_mode: 100000.0     # Extreme penalty: prefer 100km detour over high-risk road
    balanced_mode: 2000.0     # Moderate penalty: 2km per risk unit (default)
    fastest_mode: 0.0         # No penalty: ignore risk completely (dangerous!)

  # Node search configuration
  search:
    max_node_distance_m: 500      # Maximum distance to find nearest road node
    cache_enabled: true            # Enable coordinate-to-node caching
    cache_ttl_seconds: 3600        # Cache expiry (1 hour)
    cache_max_entries: 10000       # Maximum cached lookups

  # Route warnings
  warnings:
    long_route_threshold_m: 10000   # Warn if route > 10km
    high_risk_threshold: 0.7        # Risk >= 70% triggers warning
    critical_risk_threshold: 0.9    # Risk >= 90% triggers critical warning
    moderate_risk_threshold: 0.5    # Risk >= 50% triggers caution

  # Evacuation centers
  evacuation:
    max_centers_to_evaluate: 5    # Evaluate top N nearest centers
    prefer_capacity_over_distance: false  # Prioritize large shelters?

# ==========================================
# HAZARD AGENT CONFIGURATION
# ==========================================
hazard_agent:
  # Cache management
  caches:
    max_flood_entries: 100        # Maximum flood data cache size
    max_scout_entries: 1000       # Maximum scout report cache size
    cleanup_interval_sec: 300     # Run cache cleanup every 5 minutes
    use_deque: true               # Use deque for automatic eviction (recommended)

  # Risk calculation weights
  # Must sum to 1.0 for proper normalization
  risk_weights:
    flood_depth: 0.5      # Official flood depth data (50%)
    crowdsourced: 0.3     # Scout crowdsourced reports (30%)
    historical: 0.2       # Historical flood patterns (20%)

  # Time-based risk decay
  # Models how flood risk decreases over time
  risk_decay:
    enable: true

    # Decay rates (fraction per minute)
    # Formula: risk(t) = risk(0) * exp(-rate * minutes)
    scout_fast_rate: 0.10   # 10%/min - Rain-based flooding (drains quickly)
    scout_slow_rate: 0.03   # 3%/min - River/dam flooding (slow recession)
    flood_rate: 0.05        # 5%/min - Official data decay

    # Time-to-live (minutes before expiry)
    ttl_minutes:
      scout_reports: 45     # Scout reports expire after 45 minutes
      flood_data: 90        # Flood agency data expires after 90 minutes

    # Risk thresholds
    risk_floor: 0.15              # Minimum risk until scout validates "clear"
    min_threshold: 0.01           # Risk below this is considered "clear"

  # Spatial risk propagation
  spatial:
    enable_filtering: true        # Apply risk only within radius of report
    risk_radius_m: 800            # Apply environmental risk within 800m
    use_spatial_index: true       # Enable grid-based spatial indexing
    grid_size_degrees: 0.01       # ~1.1km grid cells for indexing
    decay_function: "linear"      # Options: "linear", "exponential", "gaussian"

  # GeoTIFF flood simulation
  geotiff:
    enable: true
    default_return_period: "rr01"  # Default: 2-year return period
    default_time_step: 1            # Default: 1 hour ahead prediction

    # Available return periods: rr01 (2yr), rr05 (5yr), rr10 (10yr), rr25 (25yr)
    # Time steps: 1-18 (1 = 1hr, 18 = 18hrs ahead)

    batch_queries: true             # Batch GeoTIFF queries for performance
    cache_flood_depths: true        # Cache depth queries for 5 minutes

  # Risk calculation formulas
  formulas:
    # Flood depth to risk conversion
    depth_to_risk:
      method: "sigmoid"             # Options: "linear", "sigmoid", "exponential"
      sigmoid_steepness: 2.0        # k parameter in sigmoid curve
      sigmoid_inflection: 0.5       # x0 parameter (50% risk at 0.5m)
      max_depth_m: 2.0              # Depth >= this is 100% risk

    # Rainfall to risk conversion
    rainfall_thresholds_mm:
      light: 2.5
      moderate: 7.5
      heavy: 15.0
      extreme: 30.0

    # Risk combination strategy
    risk_fusion:
      method: "weighted_average"    # Options: "max", "weighted_average", "bayesian"
      confidence_weight: 0.8        # Weight for high-confidence reports

# ==========================================
# FLOOD AGENT CONFIGURATION
# ==========================================
flood_agent:
  # Data collection frequency
  update_interval_sec: 300        # Fetch data every 5 minutes

  # API configuration
  apis:
    enable_real_apis: true
    enable_simulated_fallback: true

    rate_limits:
      pagasa_calls_per_hour: 60     # Rate limit for PAGASA scraper
      openweathermap_calls_per_day: 1000  # OWM free tier limit

    timeouts_sec:
      scraper_timeout: 30
      api_timeout: 10

  # Passability thresholds (SAFETY CRITICAL)
  # Based on FEMA flood safety guidelines
  passability:
    method: "velocity_depth_product"  # Recommended method
    max_safe_depth_m: 0.3             # 1 ft = maximum safe depth for cars
    flow_velocity_mps: 0.5            # Static assumption for urban flooding
    danger_threshold: 0.6             # depth * velocity > 0.6 is dangerous

    # Alternative: simple depth threshold (less accurate)
    # method: "depth_only"
    # max_safe_depth_m: 0.3

  # Risk scoring thresholds
  risk_thresholds:
    # Rainfall intensity (mm/hour)
    rainfall_mm:
      light: 2.5        # Drizzle
      moderate: 7.5     # Light rain
      heavy: 15.0       # Heavy rain
      extreme: 30.0     # Torrential rain (PAGASA standards)

    # Water level deviations from normal (meters)
    water_level_deviations_m:
      alert: 0.5        # Watch: water rising
      alarm: 1.0        # Warning: prepare to evacuate
      critical: 2.0     # Danger: evacuate immediately

    # Dam water levels (meters above normal)
    dam_levels_m:
      alert: 0.5
      alarm: 1.0
      critical: 2.0

# ==========================================
# SCOUT AGENT CONFIGURATION
# ==========================================
scout_agent:
  # Batch processing
  batch_size: 10                # Process N tweets per step
  max_queue_size: 1000          # Maximum queued reports

  # Simulation mode (for testing)
  simulation:
    default_scenario: 1         # 1=light, 2=moderate, 3=severe
    use_ml_prediction: true     # Use ML models vs. ground truth
    generate_synthetic: false   # Generate random synthetic reports

  # NLP processing
  nlp:
    min_confidence: 0.6         # Minimum confidence for flood classification
    extract_severity: true      # Extract severity from text
    extract_location: true      # Extract location from text

  # Twitter API (future integration)
  twitter:
    enable: false               # Not yet implemented
    api_version: "v2"
    max_results_per_query: 100

# ==========================================
# EVACUATION MANAGER AGENT CONFIGURATION
# ==========================================
evacuation_manager_agent:
  # History tracking
  history:
    max_route_history: 1000     # Maximum routes to remember
    max_feedback_history: 1000  # Maximum user feedback entries
    use_deque: true             # Use deque for automatic eviction

  # User feedback
  feedback:
    default_confidence: 0.7     # Confidence for user-reported conditions
    weight_recent_feedback: 0.8 # Weight recent feedback higher
    feedback_ttl_hours: 24      # Feedback expires after 24 hours

  # Evacuation routing
  evacuation:
    always_use_safest_mode: true  # Force safest routing for evacuations
    check_center_capacity: false  # Verify shelter capacity before routing
    warn_if_far: true             # Warn if nearest shelter > 10km

# ==========================================
# GLOBAL AGENT SETTINGS
# ==========================================
global:
  # Logging
  logging:
    level: "INFO"               # DEBUG, INFO, WARNING, ERROR, CRITICAL
    log_agent_steps: false      # Log every agent step (verbose)
    log_message_queue: true     # Log MAS message passing

  # Message Queue (MAS Communication)
  message_queue:
    max_queue_size: 10000       # Maximum messages in queue
    message_ttl_seconds: 300    # Messages expire after 5 minutes
    enable_dead_letter: true    # Keep failed messages for debugging
    max_dead_letters: 100       # Maximum failed messages to keep

  # Performance monitoring
  performance:
    enable_profiling: false     # Enable performance profiling
    profile_slow_operations: true  # Log operations > 100ms
    slow_operation_threshold_ms: 100

# ==========================================
# VALIDATION RULES
# ==========================================
validation:
  # Coordinate bounds (Philippines region)
  coordinates:
    min_latitude: 4.0
    max_latitude: 21.0
    min_longitude: 116.0
    max_longitude: 127.0

  # Risk score bounds
  risk:
    min_value: 0.0
    max_value: 1.0

  # Cache size limits
  caches:
    min_size: 10
    max_size: 100000

# ==========================================
# EXPERIMENTAL FEATURES
# ==========================================
experimental:
  # Machine learning integration
  ml_models:
    enable_flood_prediction: false    # Future: ML-based flood forecasting
    enable_traffic_prediction: false  # Future: Traffic-aware routing
    enable_sentiment_analysis: false  # Future: Analyze tweet sentiment

  # Advanced routing
  routing:
    enable_multi_objective: false     # Future: Pareto-optimal routing
    enable_dynamic_replanning: false  # Future: Real-time route updates

  # Distributed computing
  distributed:
    enable_redis_cache: false         # Future: Distributed caching
    enable_celery_tasks: false        # Future: Async task processing
